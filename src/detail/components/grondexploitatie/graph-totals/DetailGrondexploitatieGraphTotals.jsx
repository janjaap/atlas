import React from 'react';
import PropTypes from 'prop-types';
import { Legend, BarChart, Bar, XAxis, YAxis, CartesianGrid, ResponsiveContainer, Cell, LabelList, Rectangle } from 'recharts';

import DetailGrondexploitatieGraphLegend from '../graph-legend';
import { getGrondexploitatieCategoryColor } from '../../../services/grondexploitatie/categories';
import './_detail-grondexploitatie-graph-totals.scss';

const CustomBar = (props) => {
  const { fill, height, width, x, y } = props;
  return (
    <Rectangle
      fill={fill}
      height={height / 2}
      width={width}
      x={x}
      y={y}
    />
  );
};

CustomBar.defaultProps = {
  fill: '',
  height: 0,
  width: 0,
  x: 0,
  y: 0
};

CustomBar.propTypes = {
  fill: PropTypes.string,
  height: PropTypes.number,
  width: PropTypes.number,
  x: PropTypes.number,
  y: PropTypes.number
};

const CustomLabel = (props) => {
  const { x, y, width, height, value } = props;
  return (
    <text
      x={x + width + 5}
      y={y + 10}
      width={width}
      height={height}
      fill="#000000"
      textAnchor="start"
      className="detail-grondexploitatie-graph__value"
    >
      {value}
    </text>
  );
};

CustomLabel.defaultProps = {
  height: 0,
  value: '',
  width: 0,
  x: 0,
  y: 0
};

CustomLabel.propTypes = {
  height: PropTypes.number,
  value: PropTypes.string,
  width: PropTypes.number,
  x: PropTypes.number,
  y: PropTypes.number
};

const CustomYTick = (props) => {
  const { x, y, payload } = props;
  return (
    <text
      x={x}
      y={y - 3}
      fill="#999999"
      textAnchor="end"
      className="detail-grondexploitatie-graph__y-tick"
    >
      {payload.value}
    </text>
  );
};

CustomYTick.defaultProps = {
  payload: {
    value: ''
  },
  x: 0,
  y: 0
};

CustomYTick.propTypes = {
  payload: PropTypes.shape({
    value: PropTypes.string
  }),
  x: PropTypes.number,
  y: PropTypes.number
};

const DetailGrondexploitatieGraphTotals = ({ data }) => (
  <div className="detail-grondexploitatie-graph">
    <h3 className="detail-grondexploitatie-graph__title">
      Totale begroting
    </h3>
    <div className="detail-grondexploitatie-graph__container">
      <ResponsiveContainer
        minHeight={559}
        minWidth={500}
        width="100%"
      >
        <BarChart
          barSize={20}
          data={data}
          layout="vertical"
        >
          <XAxis
            axisLine={false}
            domain={['auto', (dataMax) => Math.round(dataMax * 1.2)]}
            label={{
              fill: '#999999',
              offset: -10,
              position: 'insideBottom',
              value: 'Miljoenen'
            }}
            tick={{ fill: '#999999' }}
            tickLine={false}
            type="number"
          />
          <YAxis
            axisLine={false}
            dataKey="name"
            hide={false}
            padding={{ top: 16, bottom: 16 }}
            tick={<CustomYTick />}
            tickLine={false}
            type="category"
            width={180}
          />
          <CartesianGrid
            fill="#F6F6F6"
            horizontal={false}
          />
          <Legend content={<DetailGrondexploitatieGraphLegend />} />
          <Bar
            dataKey="begrootValue"
            name="category"
          >
            {
              data.map((entry) => (
                <Cell
                  fill={getGrondexploitatieCategoryColor(entry.id)}
                  key={entry.name}
                />
              ))
            }
            <LabelList
              dataKey="begrootLabel"
              fill="#000000"
              position="right"
            />
          </Bar>
          <Bar
            dataKey="geboektValue"
            fill="#808080"
            name="realized"
            shape={<CustomBar />}
          >
            <LabelList
              dataKey="geboektLabel"
              fill="#000000"
              position="right"
              content={<CustomLabel />}
            />
          </Bar>
        </BarChart>
      </ResponsiveContainer>
    </div>
  </div>
);

DetailGrondexploitatieGraphTotals.defaultProps = {
  data: []
};

DetailGrondexploitatieGraphTotals.propTypes = {
  data: PropTypes.arrayOf(PropTypes.shape({}))
};

export default DetailGrondexploitatieGraphTotals;
