import { batenCategories, batenCategoryLabels, kostenCategories, kostenCategoryLabels } from '../categories';
import { displayFactor, precisionRound } from '../helpers';

const parseData = (data, categories, categoryLabels) => (
  categories.map((category) => {
    const item = data.categories[category] || {};

    const begroot = Math.abs(item.begroot || 0);
    const begrootValue = begroot / displayFactor;
    const begrootRounded = precisionRound(begrootValue, 1);
    const begrootTooSmallLabel = begrootValue ? '<0,05' : '';
    const begrootLabel = begrootRounded ? `${begrootRounded}`.replace('.', ',') : begrootTooSmallLabel;

    const geboekt = Math.abs(item.geboekt || 0);
    const geboektValue = geboekt / displayFactor;
    const geboektRounded = precisionRound(geboektValue, 1);
    const geboektTooSmallLabel = geboektValue ? '<0,05' : '';
    const geboektLabel = geboektRounded ? `${geboektRounded}`.replace('.', ',') : geboektTooSmallLabel;

    return {
      begroot,
      geboekt,
      id: category,
      name: categoryLabels[category],
      begrootLabel,
      begrootValue,
      // Displaying a zero value label for 'geboekt', depending on the rounded 'begroot' value, this
      // is intentional
      geboektLabel: begrootRounded && !geboektLabel ? '0' : geboektLabel,
      geboektValue
    };
  })
);

const getTotaal = (value) => (
  value && value.totaal ? value.totaal : { categories: [] }
);

const generateGraphData = ({ baten, kosten }) => ({
  baten: parseData(getTotaal(baten), batenCategories, batenCategoryLabels),
  kosten: parseData(getTotaal(kosten), kostenCategories, kostenCategoryLabels)
});

const getMax = ({ max_totaal_axis_begroot }) =>
  // eslint-disable-next-line camelcase
  Math.ceil(Math.round(max_totaal_axis_begroot / displayFactor) * 1.2);

export {
  generateGraphData,
  getMax
};
